# 3-Way handshake & 4-Way hadnshake

## π“ 3 way handshake

TCP/IP ν”„λ΅ν† μ½μ„ μ΄μ©ν•μ—¬ ν†µμ‹ μ„ μ§„ν–‰ν•  λ•, λ‘ μΆ…λ‹¨ κ°„ **μ •ν™•ν•** λ°μ΄ν„° μ „μ†΅μ„ λ³΄μ¥ν•κΈ° μ„ν•΄ μ—°κ²°μ„ μ„¤μ •ν•λ” κ³Όμ •μ΄λ‹¤.

[![img](https://user-images.githubusercontent.com/33534771/75338886-d77ea880-58d2-11ea-84c3-f8b60663f9c6.png)](https://user-images.githubusercontent.com/33534771/75338886-d77ea880-58d2-11ea-84c3-f8b60663f9c6.png)

**[μ—°κ²° κ³Όμ •]**

> SYN : Synchronize Sequence Number
>
> ACK : Acknowledgement

1. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ— μ ‘μ†μ„ μ”μ²­ν•λ” SYN(a) ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ μ”μ²­μΈ SYN(a) ν¨ν‚·μ— λ€ν• μ”μ²­ μλ½ μ‘λ‹µμΌλ΅ ACK(a+1) ν¨ν‚·κ³Ό ν΄λΌμ΄μ–ΈνΈλ„ ν¬νΈλ¥Ό μ—΄μ–΄λ‹¬λΌλ” SYN(b) ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
3. ν΄λΌμ΄μ–ΈνΈλ” ACK(a+1) ν¨ν‚·κ³Ό SYN(b) ν¨ν‚·μ„ λ°›κ³  μ΄μ— λ€ν• μ‘λ‹µμΌλ΅ ACK(b+1) ν¨ν‚·μ„ λ³΄λ‚΄λ©° μ—°κ²°μ΄ μ„±λ¦½λλ‹¤.

**[Q. μ™ 2wayκ°€ μ•„λ‹λΌ 3wayμΌκΉ?]**

**TCP**λ” `μ–‘λ°©ν–¥μ„± μ—°κ²°`μ΄κΈ° λ•λ¬Έμ— ν΄λΌμ΄μ–ΈνΈμ—μ„ μ„λ²„μ—κ² μμ‹ μ μ΅΄μ¬λ¥Ό μ•λ¦¬κ³  ν¨ν‚·μ„ λ³΄λ‚Ό μ μλ” κ²ƒμ²λΌ μ„λ²„μ—μ„λ„ ν΄λΌμ΄μ–ΈνΈμ—κ² μμ‹ μ μ΅΄μ¬λ¥Ό μ•λ¦¬κ³  ν¨ν‚·μ„ λ³΄λ‚Ό μ μλ‹¤λ” μ‹ νΈλ¥Ό λ³΄λ‚΄μ•Ό ν•κΈ° λ•λ¬Έμ΄λ‹¤.

**[μ°Έκ³ ]**

**μ²μμ— ν΄λΌμ΄μ–ΈνΈμ—μ„ SYN ν¨ν‚·μ„ λ³΄λ‚Ό λ• Sequence Numberμ—λ” λλ¤ν• μ«μκ°€ λ‹΄κ²¨μ§„λ‹¤.**

Connectionμ„ λ§Ίμ„ λ•, μ‚¬μ©ν•λ” ν¬νΈ(port)λ” μ ν• λ²”μ„ λ‚΄μ—μ„ μ‚¬μ©ν•κ³  μ‹κ°„μ΄ μ§€λ‚¨μ— λ”°λΌ μ¬μ‚¬μ©ν•λ‹¤. λ”°λΌμ„ μ΄μ „μ— μ‚¬μ©ν• ν¬νΈ λ²νΈλ¥Ό μ¬μ‚¬μ©ν•  κ°€λ¥μ„±μ΄ μλ‹¤.

Sequence Numberκ°€ μμ°¨μ μΈ μ«μλ΅ μ „μ†΅λλ‹¤λ©΄ μ„λ²„λ” μ΄μ „μ ConnectionμΌλ΅λ¶€ν„° μ „μ†΅λλ” ν¨ν‚·μΌλ΅ μΈμ‹ν•  μ μλ‹¤. λ”°λΌμ„ μ΄λ¬ν• λ¬Έμ λ¥Ό ν•΄κ²°ν•κΈ° μ„ν•΄ λ‚μλ΅ μ΄κΈ° Sequence Numberλ¥Ό μ„¤μ •ν•λ‹¤.

## π“ 4 way handshake

TCP/IP ν”„λ΅ν† μ½μ„ μ΄μ©ν• ν†µμ‹  κ³Όμ •μ—μ„λ” μ„μ—μ„ μ–ΈκΈ‰ν–λ κ²ƒμ²λΌ 3 way handshake κ³Όμ •μ„ ν†µν•΄ μ—°κ²°μ„ μ„¤μ •ν•κ³  4 way handshake κ³Όμ •μ„ ν†µν•΄ μ—°κ²° μ„¤μ •μ„ ν•΄μ ν•λ‹¤.

[![img](https://user-images.githubusercontent.com/33534771/75338959-ef562c80-58d2-11ea-99eb-1c09ec97e83a.png)](https://user-images.githubusercontent.com/33534771/75338959-ef562c80-58d2-11ea-99eb-1c09ec97e83a.png)

**[μ—°κ²° κ³Όμ •]**

1. ν΄λΌμ΄μ–ΈνΈλ” μ„λ²„μ—κ² μ—°κ²°μ„ μΆ…λ£ν•κ² λ‹¤λ” FIN ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
2. μ„λ²„λ” ν΄λΌμ΄μ–ΈνΈμ μ”μ²­(FIN)μ— λ€ν• μ‘λ‹µμΌλ΅ ACK ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.

 2-1) μ²λ¦¬ν•΄μ•Ό ν•  μμ‹ μ ν†µμ‹ μ΄ λλ‚  λ•κΉμ§€ κΈ°λ‹¤λ¦°λ‹¤.

1. μ²λ¦¬ν•΄μ•Ό ν•  λ¨λ“  ν†µμ‹ μ„ λλ§μ³¤λ‹¤λ©΄ μ—°κ²°μ„ μΆ…λ£ν•κ² λ‹¤λ” FIN ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
2. ν΄λΌμ΄μ–ΈνΈλ” FIN ν¨ν‚·μ— λ€ν• ν™•μΈ μ‘λ‹µμΌλ΅ ACK ν¨ν‚·μ„ λ³΄λ‚Έλ‹¤.
3. ν΄λΌμ΄μ–ΈνΈμ ACK ν¨ν‚·μ„ λ°›μ€ μ„λ²„λ” μ†μΌ“ μ—°κ²°μ„ close ν•λ‹¤.
4. ν΄λΌμ΄μ–ΈνΈλ” μ•„μ§ μ„λ²„λ΅λ¶€ν„° λ°›μ§€ λ»ν• λ°μ΄ν„°κ°€ μμ„ κ²ƒμ„ λ€λΉ„ν•΄ κΈ°λ‹¤λ¦¬λ” κ³Όμ •μ„ κ±°μΉλ‹¤.(TIME_WAIT)

[μ—λ¬ λ°μƒ]

ν΄λΌμ΄μ–ΈνΈμ—μ„ FIN ν¨ν‚· μ „μ†΅ ν›„ ACK ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” FIN_WAIT1κ³Ό μ„λ²„μ ACK ν¨ν‚·μ„ λ°›μ€ ν›„ FIN ν¨ν‚·μ„ κΈ°λ‹¤λ¦¬λ” FIN_WAIT2 μ—λ¬ λ°μƒμΌλ΅ μΈν•΄ Time outμ΄ λλ©΄ μ¤μ¤λ΅ μ—°κ²°μ„ μΆ…λ£ν•λ‹¤.

κ·Έλ¬λ‚, CLOSE_WAITμ€ Applicationμ΄ close()λ¥Ό μ μ ν•κ² μ²λ¦¬ν•μ§€ λ»ν•λ©΄ CLOSE_WAIT μƒνƒλ΅ κ³„μ† κΈ°λ‹¤λ¦¬κ² λμ–΄ Socket Hang Up μ—λ¬κ°€ λ°μƒν•  μ μλ‹¤.